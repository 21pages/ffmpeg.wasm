<html>
  <head>
    <script src="/dist/ffmpeg.dev.js"></script>
  </head>
  <body>
    <div>
      <input type="file" id="uploader">
    </div>
    <script>
      const { createWorker } = FFmpeg;
      const worker = createWorker({
        corePath: '../../node_modules/@ffmpeg/core/ffmpeg-core.js',
      });

      const transcode = async ({ target: { files }  }) => {
        await worker.load();
        console.log('Start transcoding');
        const { data } = await worker.transcode(files[0], 'mp4');
        console.log('Complete transcoding');

        const video = document.createElement('video');
        video.controls = true;
        video.src = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
        document.body.appendChild(video);
      }
      const elm = document.getElementById('uploader');
      elm.addEventListener('change', transcode);
    </script>
  </body>
</html>
